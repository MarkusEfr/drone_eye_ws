<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Drone Eye Processor</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        #progress {
            margin-top: 15px;
            font-size: 18px;
        }

        #result {
            margin-top: 20px;
            font-size: 20px;
        }
    </style>
</head>

<body>
    <h1>Drone Eye Video Processing</h1>
    <form id="uploadForm">
        <input type="file" name="file" id="fileInput" accept="video/*" required>
        <button type="submit">Upload</button>
    </form>

    <div id="progress">Waiting for upload…</div>
    <div id="result"></div>

    <script>
        let pollTimer = null;

        document.getElementById("uploadForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const fileInput = document.getElementById("fileInput");
            if (!fileInput.files.length) return;

            const formData = new FormData();
            formData.append("file", fileInput.files[0]);

            document.getElementById("progress").textContent = "Uploading…";

            const res = await fetch("/upload", { method: "POST", body: formData });
            const data = await res.json();
            const session = data.session;

            document.getElementById("progress").textContent =
                `Uploaded. Session: ${session}. Processing started…`;

            pollStatus(session);
        });

        function pollStatus(session) {
            pollTimer = setInterval(async () => {
                const res = await fetch(`/status/${session}`);
                const st = await res.json();
                const status = document.getElementById("progress");
                status.textContent =
                    `Progress: ${st.progress}%\n` +
                    `Frames: ${st.processed_frames}/${st.total_frames}`;

                if (st.done) {
                    clearInterval(pollTimer);
                    const result = document.getElementById("result");
                    result.innerHTML = `
            <br><a href="${st.video}" target="_blank">⬇ Download Processed Video</a>
          `;
                    status.textContent += "\n✅ Processing completed";
                }
            }, 1000);
        }
    </script>
</body>

</html>